#!/usr/bin/env sage

import sys
from sage.all import *
from itertools import product

n = 28
p = set([(0, 1), (0, 3), (0, 5), (0, 7), (0, 9), (0, 11), (0, 13), (0, 15), (0, 17), (0, 19), (0, 21), (0, 23), (0, 24), (1, 4), (1, 8), (1, 12), (1, 16), (1, 20), (1, 25), (1, 26), (3, 4), (3, 8), (3, 12), (3, 16), (3, 20), (3, 25), (3, 26), (4, 5), (4, 7), (4, 9), (4, 11), (4, 13), (4, 15), (4, 17), (4, 19), (4, 21), (4, 23), (4, 24), (5, 8), (5, 12), (5, 16), (5, 20), (5, 25), (5, 26), (7, 8), (7, 12), (7, 16), (7, 20), (7, 25), (7, 26), (8, 9), (8, 11), (8, 13), (8, 15), (8, 17), (8, 19), (8, 21), (8, 23), (8, 24), (9, 12), (9, 16), (9, 20), (9, 25), (9, 26), (11, 12), (11, 16), (11, 20), (11, 25), (11, 26), (12, 13), (12, 15), (12, 17), (12, 19), (12, 21), (12, 23), (12, 24), (13, 16), (13, 20), (13, 25), (13, 26), (15, 16), (15, 20), (15, 25), (15, 26), (16, 17), (16, 19), (16, 21), (16, 23), (16, 24), (17, 20), (17, 25), (17, 26), (19, 20), (19, 25), (19, 26), (20, 21), (20, 23), (20, 24), (21, 25), (21, 26), (23, 25), (23, 26), (24, 25), (24, 26)])

n = 40
p = [(0, 1), (0, 3), (0, 5), (0, 7), (0, 9), (0, 11), (0, 13), (0, 15), (0, 17), (0, 19), (0, 21), (0, 23), (0, 25), (0, 27), (0, 29), (0, 31), (0, 33), (0, 35), (0, 36), (1, 4), (1, 8), (1, 12), (1, 16), (1, 20), (1, 24), (1, 28), (1, 32), (1, 37), (1, 38), (3, 4), (3, 8), (3, 12), (3, 16), (3, 20), (3, 24), (3, 28), (3, 32), (3, 37), (3, 38), (4, 5), (4, 7), (4, 9), (4, 11), (4, 13), (4, 15), (4, 17), (4, 19), (4, 21), (4, 23), (4, 25), (4, 27), (4, 29), (4, 31), (4, 33), (4, 35), (4, 36), (5, 8), (5, 12), (5, 16), (5, 20), (5, 24), (5, 28), (5, 32), (5, 37), (5, 38), (7, 8), (7, 12), (7, 16), (7, 20), (7, 24), (7, 28), (7, 32), (7, 37), (7, 38), (8, 9), (8, 11), (8, 13), (8, 15), (8, 17), (8, 19), (8, 21), (8, 23), (8, 25), (8, 27), (8, 29), (8, 31), (8, 33), (8, 35), (8, 36), (9, 12), (9, 16), (9, 20), (9, 24), (9, 28), (9, 32), (9, 37), (9, 38), (11, 12), (11, 16), (11, 20), (11, 24), (11, 28), (11, 32), (11, 37), (11, 38), (12, 13), (12, 15), (12, 17), (12, 19), (12, 21), (12, 23), (12, 25), (12, 27), (12, 29), (12, 31), (12, 33), (12, 35), (12, 36), (13, 16), (13, 20), (13, 24), (13, 28), (13, 32), (13, 37), (13, 38), (15, 16), (15, 20), (15, 24), (15, 28), (15, 32), (15, 37), (15, 38), (16, 17), (16, 19), (16, 21), (16, 23), (16, 25), (16, 27), (16, 29), (16, 31), (16, 33), (16, 35), (16, 36), (17, 20), (17, 24), (17, 28), (17, 32), (17, 37), (17, 38), (19, 20), (19, 24), (19, 28), (19, 32), (19, 37), (19, 38), (20, 21), (20, 23), (20, 25), (20, 27), (20, 29), (20, 31), (20, 33), (20, 35), (20, 36), (21, 24), (21, 28), (21, 32), (21, 37), (21, 38), (23, 24), (23, 28), (23, 32), (23, 37), (23, 38), (24, 25), (24, 27), (24, 29), (24, 31), (24, 33), (24, 35), (24, 36), (25, 28), (25, 32), (25, 37), (25, 38), (27, 28), (27, 32), (27, 37), (27, 38), (28, 29), (28, 31), (28, 33), (28, 35), (28, 36), (29, 32), (29, 37), (29, 38), (31, 32), (31, 37), (31, 38), (32, 33), (32, 35), (32, 36), (33, 37), (33, 38), (35, 37), (35, 38), (36, 37), (36, 38)]

n = 48
p = [(0, 1), (0, 3), (0, 5), (0, 7), (0, 9), (0, 11), (0, 13), (0, 15), (0, 17), (0, 19), (0, 21), (0, 23), (0, 25), (0, 27), (0, 29), (0, 31), (0, 33), (0, 35), (0, 37), (0, 39), (0, 41), (0, 43), (0, 44), (1, 4), (1, 8), (1, 12), (1, 16), (1, 20), (1, 24), (1, 28), (1, 32), (1, 36), (1, 40), (1, 45), (1, 46), (3, 4), (3, 8), (3, 12), (3, 16), (3, 20), (3, 24), (3, 28), (3, 32), (3, 36), (3, 40), (3, 45), (3, 46), (4, 5), (4, 7), (4, 9), (4, 11), (4, 13), (4, 15), (4, 17), (4, 19), (4, 21), (4, 23), (4, 25), (4, 27), (4, 29), (4, 31), (4, 33), (4, 35), (4, 37), (4, 39), (4, 41), (4, 43), (4, 44), (5, 8), (5, 12), (5, 16), (5, 20), (5, 24), (5, 28), (5, 32), (5, 36), (5, 40), (5, 45), (5, 46), (7, 8), (7, 12), (7, 16), (7, 20), (7, 24), (7, 28), (7, 32), (7, 36), (7, 40), (7, 45), (7, 46), (8, 9), (8, 11), (8, 13), (8, 15), (8, 17), (8, 19), (8, 21), (8, 23), (8, 25), (8, 27), (8, 29), (8, 31), (8, 33), (8, 35), (8, 37), (8, 39), (8, 41), (8, 43), (8, 44), (9, 12), (9, 16), (9, 20), (9, 24), (9, 28), (9, 32), (9, 36), (9, 40), (9, 45), (9, 46), (11, 12), (11, 16), (11, 20), (11, 24), (11, 28), (11, 32), (11, 36), (11, 40), (11, 45), (11, 46), (12, 13), (12, 15), (12, 17), (12, 19), (12, 21), (12, 23), (12, 25), (12, 27), (12, 29), (12, 31), (12, 33), (12, 35), (12, 37), (12, 39), (12, 41), (12, 43), (12, 44), (13, 16), (13, 20), (13, 24), (13, 28), (13, 32), (13, 36), (13, 40), (13, 45), (13, 46), (15, 16), (15, 20), (15, 24), (15, 28), (15, 32), (15, 36), (15, 40), (15, 45), (15, 46), (16, 17), (16, 19), (16, 21), (16, 23), (16, 25), (16, 27), (16, 29), (16, 31), (16, 33), (16, 35), (16, 37), (16, 39), (16, 41), (16, 43), (16, 44), (17, 20), (17, 24), (17, 28), (17, 32), (17, 36), (17, 40), (17, 45), (17, 46), (19, 20), (19, 24), (19, 28), (19, 32), (19, 36), (19, 40), (19, 45), (19, 46), (20, 21), (20, 23), (20, 25), (20, 27), (20, 29), (20, 31), (20, 33), (20, 35), (20, 37), (20, 39), (20, 41), (20, 43), (20, 44), (21, 24), (21, 28), (21, 32), (21, 36), (21, 40), (21, 45), (21, 46), (23, 24), (23, 28), (23, 32), (23, 36), (23, 40), (23, 45), (23, 46), (24, 25), (24, 27), (24, 29), (24, 31), (24, 33), (24, 35), (24, 37), (24, 39), (24, 41), (24, 43), (24, 44), (25, 28), (25, 32), (25, 36), (25, 40), (25, 45), (25, 46), (27, 28), (27, 32), (27, 36), (27, 40), (27, 45), (27, 46), (28, 29), (28, 31), (28, 33), (28, 35), (28, 37), (28, 39), (28, 41), (28, 43), (28, 44), (29, 32), (29, 36), (29, 40), (29, 45), (29, 46), (31, 32), (31, 36), (31, 40), (31, 45), (31, 46), (32, 33), (32, 35), (32, 37), (32, 39), (32, 41), (32, 43), (32, 44), (33, 36), (33, 40), (33, 45), (33, 46), (35, 36), (35, 40), (35, 45), (35, 46), (36, 37), (36, 39), (36, 41), (36, 43), (36, 44), (37, 40), (37, 45), (37, 46), (39, 40), (39, 45), (39, 46), (40, 41), (40, 43), (40, 44), (41, 45), (41, 46), (43, 45), (43, 46), (44, 45), (44, 46)]

n = 60
p = [(0, 1), (0, 3), (0, 5), (0, 7), (0, 9), (0, 11), (0, 13), (0, 15), (0, 17), (0, 19), (0, 21), (0, 23), (0, 25), (0, 27), (0, 29), (0, 31), (0, 33), (0, 35), (0, 37), (0, 39), (0, 41), (0, 43), (0, 45), (0, 47), (0, 49), (0, 51), (0, 53), (0, 55), (0, 56), (1, 4), (1, 8), (1, 12), (1, 16), (1, 20), (1, 24), (1, 28), (1, 32), (1, 36), (1, 40), (1, 44), (1, 48), (1, 52), (1, 57), (1, 58), (3, 4), (3, 8), (3, 12), (3, 16), (3, 20), (3, 24), (3, 28), (3, 32), (3, 36), (3, 40), (3, 44), (3, 48), (3, 52), (3, 57), (3, 58), (4, 5), (4, 7), (4, 9), (4, 11), (4, 13), (4, 15), (4, 17), (4, 19), (4, 21), (4, 23), (4, 25), (4, 27), (4, 29), (4, 31), (4, 33), (4, 35), (4, 37), (4, 39), (4, 41), (4, 43), (4, 45), (4, 47), (4, 49), (4, 51), (4, 53), (4, 55), (4, 56), (5, 8), (5, 12), (5, 16), (5, 20), (5, 24), (5, 28), (5, 32), (5, 36), (5, 40), (5, 44), (5, 48), (5, 52), (5, 57), (5, 58), (7, 8), (7, 12), (7, 16), (7, 20), (7, 24), (7, 28), (7, 32), (7, 36), (7, 40), (7, 44), (7, 48), (7, 52), (7, 57), (7, 58), (8, 9), (8, 11), (8, 13), (8, 15), (8, 17), (8, 19), (8, 21), (8, 23), (8, 25), (8, 27), (8, 29), (8, 31), (8, 33), (8, 35), (8, 37), (8, 39), (8, 41), (8, 43), (8, 45), (8, 47), (8, 49), (8, 51), (8, 53), (8, 55), (8, 56), (9, 12), (9, 16), (9, 20), (9, 24), (9, 28), (9, 32), (9, 36), (9, 40), (9, 44), (9, 48), (9, 52), (9, 57), (9, 58), (11, 12), (11, 16), (11, 20), (11, 24), (11, 28), (11, 32), (11, 36), (11, 40), (11, 44), (11, 48), (11, 52), (11, 57), (11, 58), (12, 13), (12, 15), (12, 17), (12, 19), (12, 21), (12, 23), (12, 25), (12, 27), (12, 29), (12, 31), (12, 33), (12, 35), (12, 37), (12, 39), (12, 41), (12, 43), (12, 45), (12, 47), (12, 49), (12, 51), (12, 53), (12, 55), (12, 56), (13, 16), (13, 20), (13, 24), (13, 28), (13, 32), (13, 36), (13, 40), (13, 44), (13, 48), (13, 52), (13, 57), (13, 58), (15, 16), (15, 20), (15, 24), (15, 28), (15, 32), (15, 36), (15, 40), (15, 44), (15, 48), (15, 52), (15, 57), (15, 58), (16, 17), (16, 19), (16, 21), (16, 23), (16, 25), (16, 27), (16, 29), (16, 31), (16, 33), (16, 35), (16, 37), (16, 39), (16, 41), (16, 43), (16, 45), (16, 47), (16, 49), (16, 51), (16, 53), (16, 55), (16, 56), (17, 20), (17, 24), (17, 28), (17, 32), (17, 36), (17, 40), (17, 44), (17, 48), (17, 52), (17, 57), (17, 58), (19, 20), (19, 24), (19, 28), (19, 32), (19, 36), (19, 40), (19, 44), (19, 48), (19, 52), (19, 57), (19, 58), (20, 21), (20, 23), (20, 25), (20, 27), (20, 29), (20, 31), (20, 33), (20, 35), (20, 37), (20, 39), (20, 41), (20, 43), (20, 45), (20, 47), (20, 49), (20, 51), (20, 53), (20, 55), (20, 56), (21, 24), (21, 28), (21, 32), (21, 36), (21, 40), (21, 44), (21, 48), (21, 52), (21, 57), (21, 58), (23, 24), (23, 28), (23, 32), (23, 36), (23, 40), (23, 44), (23, 48), (23, 52), (23, 57), (23, 58), (24, 25), (24, 27), (24, 29), (24, 31), (24, 33), (24, 35), (24, 37), (24, 39), (24, 41), (24, 43), (24, 45), (24, 47), (24, 49), (24, 51), (24, 53), (24, 55), (24, 56), (25, 28), (25, 32), (25, 36), (25, 40), (25, 44), (25, 48), (25, 52), (25, 57), (25, 58), (27, 28), (27, 32), (27, 36), (27, 40), (27, 44), (27, 48), (27, 52), (27, 57), (27, 58), (28, 29), (28, 31), (28, 33), (28, 35), (28, 37), (28, 39), (28, 41), (28, 43), (28, 45), (28, 47), (28, 49), (28, 51), (28, 53), (28, 55), (28, 56), (29, 32), (29, 36), (29, 40), (29, 44), (29, 48), (29, 52), (29, 57), (29, 58), (31, 32), (31, 36), (31, 40), (31, 44), (31, 48), (31, 52), (31, 57), (31, 58), (32, 33), (32, 35), (32, 37), (32, 39), (32, 41), (32, 43), (32, 45), (32, 47), (32, 49), (32, 51), (32, 53), (32, 55), (32, 56), (33, 36), (33, 40), (33, 44), (33, 48), (33, 52), (33, 57), (33, 58), (35, 36), (35, 40), (35, 44), (35, 48), (35, 52), (35, 57), (35, 58), (36, 37), (36, 39), (36, 41), (36, 43), (36, 45), (36, 47), (36, 49), (36, 51), (36, 53), (36, 55), (36, 56), (37, 40), (37, 44), (37, 48), (37, 52), (37, 57), (37, 58), (39, 40), (39, 44), (39, 48), (39, 52), (39, 57), (39, 58), (40, 41), (40, 43), (40, 45), (40, 47), (40, 49), (40, 51), (40, 53), (40, 55), (40, 56), (41, 44), (41, 48), (41, 52), (41, 57), (41, 58), (43, 44), (43, 48), (43, 52), (43, 57), (43, 58), (44, 45), (44, 47), (44, 49), (44, 51), (44, 53), (44, 55), (44, 56), (45, 48), (45, 52), (45, 57), (45, 58), (47, 48), (47, 52), (47, 57), (47, 58), (48, 49), (48, 51), (48, 53), (48, 55), (48, 56), (49, 52), (49, 57), (49, 58), (51, 52), (51, 57), (51, 58), (52, 53), (52, 55), (52, 56), (53, 57), (53, 58), (55, 57), (55, 58), (56, 57), (56, 58)]

def upperbound_rank(n: int, p: List[Tuple[int, int]]) -> int:
    pairs_index = [(i,j) for i,j in product(range(n), range(n)) if i < j]
    pairs_map = dict()
    for i, (j, k) in enumerate(pairs_index):
        pairs_map[(j,k)] = i

    equations = []
    pairs_patterns = []
    for i, j in product(range(4), range(4)):
        if i >= j:
            continue
        t = []
        for k in range(4):
            if k not in [i,j]:
                t.append(k)
        pairs_patterns.append(((i, j), tuple(t)))
    for i,j,k,l in product(range(n), repeat=4):
        if i >= j or j >= k or k >= l:
            continue
        indices = [i, j, k, l]
        equation = []
        for ((a, b), (c, d)) in pairs_patterns:
            ra, rb, rc, rd = map(lambda x: indices[x], (a,b,c,d))
            if (ra, rb) in p:
                equation.append((rc, rd))
        equations.append(equation)

    matrix_sparse = dict()
    for i, eq in enumerate(equations):
        for a, b in eq:
            matrix_sparse[i, pairs_map[(a,b)]] = 1

    
    A = matrix(GF(2), len(equations), len(pairs_index), matrix_sparse)
    return len(pairs) - A.rank()